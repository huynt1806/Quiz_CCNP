<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game: Cisco ISE Master!</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        #game-container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px;
            text-align: center;
            position: relative; /* Needed for absolute positioning of toggle button */
        }

        h1 {
            color: #007bff;
            margin-bottom: 30px;
        }

        #start-screen, #results-screen {
             display: block;
        }
        #quiz-screen{
             display: none;
        }

        #question-container {
            margin-bottom: 25px;
        }

        #question-text {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 60px;
             color: #444;
        }

        #answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

         @media (min-width: 600px) {
            #answer-options {
                grid-template-columns: 1fr 1fr;
            }
         }

        .option-btn {
            background-color: #e9ecef;
            border: 2px solid #ced4da;
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.1s ease;
            text-align: left;
            width: 100%;
             box-sizing: border-box;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #dde2e6;
            border-color: #adb5bd;
        }
        .option-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .option-btn.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            font-weight: bold;
        }

        .option-btn.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .option-btn.show-correct {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        #feedback-container {
            margin-top: 25px;
            min-height: 80px;
             font-size: 0.95em;
             line-height: 1.5;
             color: #555;
        }
        #explanation {
             font-style: italic;
             margin-top: 10px;
             color: #6c757d;
        }

        #progress-info {
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #6c757d;
            display: flex;
            justify-content: space-between;
            align-items: center; /* Align items vertically */
        }

        #next-btn, #start-btn, #restart-btn, .toggle-music-btn { /* CHANGED: Added .toggle-music-btn */
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px; /* Adjusted padding */
            font-size: 1em; /* Adjusted font size */
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px; /* Adjusted margin */
            transition: background-color 0.3s ease, transform 0.1s ease;
            vertical-align: middle; /* Align with text */
        }
        #next-btn{
             display: none;
             margin-top: 25px; /* Keep original margin for next button */
             padding: 12px 30px; /* Keep original padding */
             font-size: 1.1em; /* Keep original font size */
        }
        .toggle-music-btn { /* Style for music buttons */
             background-color: #6c757d; /* Default grey */
             margin-left: 10px;
             font-size: 0.9em; /* Smaller font */
             padding: 8px 15px; /* Smaller padding */
        }
         /* Style for the in-quiz toggle button position */
         #toggle-music-quiz-btn {
             /* Position it near the progress info or elsewhere */
             /* Example: place it next to score */
             /* margin-left: auto; /* Push to the right if needed */
         }


        #start-btn:hover, #restart-btn:hover, #next-btn:hover, .toggle-music-btn:hover {
            background-color: #0056b3;
        }
         .toggle-music-btn.on { /* Style when music is ON */
              background-color: #28a745; /* Green when ON */
         }
         .toggle-music-btn.on:hover {
              background-color: #218838;
         }


        #start-btn:active, #restart-btn:active, #next-btn:active, .toggle-music-btn:active {
             transform: scale(0.98);
        }

        #results-screen h2{
             color: #28a745;
             margin-bottom: 20px;
        }
        #final-score-text{
             font-size: 1.5em;
             font-weight: bold;
             margin-bottom: 30px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

    </style>
</head>
<body>
    <div id="game-container">
        <h1>Cisco ISE Master Quiz!</h1>

        <div id="start-screen">
            <p>Bạn đã sẵn sàng kiểm tra kiến thức về Cisco ISE?</p>
            <p>Trả lời 50 câu hỏi và xem bạn có phải là chuyên gia không nhé!</p>
            <button id="start-btn">Bắt đầu!</button>
            <button id="toggle-music-start-btn" class="toggle-music-btn">Bật Nhạc Nền</button>
        </div>

        <div id="quiz-screen">
             <div id="progress-info">
                 <div> {/* Wrapper for left elements */}
                    <span id="question-counter"></span>
                    <span id="score-display">Điểm: 0</span>
                 </div>
                 {/* CHANGED: Added toggle button here */}
                 <button id="toggle-music-quiz-btn" class="toggle-music-btn">Bật Nhạc Nền</button>
            </div>
            <div id="question-container">
                <p id="question-text"></p>
            </div>
            <div id="answer-options">
                {/* Option buttons will be generated here by JS */}
            </div>
            <div id="feedback-container">
                 <p id="explanation"></p>
            </div>
            <button id="next-btn">Câu tiếp theo</button>
        </div>

         <div id="results-screen" style="display: none;">
            <h2>Hoàn thành!</h2>
            <p id="final-score-text"></p>
            <p id="result-message"></p>
            <button id="restart-btn">Chơi lại</button>
        </div>
    </div>

    {/* Audio Elements */}
    <audio id="correct-sound" src="correct.mp3" preload="auto"></audio>
    <audio id="incorrect-sound" src="incorrect.mp3" preload="auto"></audio>
    <audio id="background-music" src="background.mp3" loop preload="auto"></audio>


    <script>
        const quizData = [
            // --- PASTE ALL 50 QUESTIONS FROM THE PREVIOUS RESPONSE HERE ---
            // (Keeping the same example structure)
             { question: "1. Mục đích chính của Cisco ISE (Identity Services Engine) là gì?", options: ["Tăng tốc độ truy cập Internet", "Quản lý chính sách bảo mật và xác thực người dùng/thiết bị trong mạng", "Sao lưu dữ liệu máy chủ", "Phát hiện và loại bỏ virus trên máy tính"], correctAnswer: 1, explanation: "Cisco ISE là nền tảng quản lý chính sách bảo mật và xác thực, giúp kiểm soát quyền truy cập vào tài nguyên mạng và đảm bảo an ninh."},
             // ... (rest of the 50 questions) ...
              { question: "50. Lợi ích chính của việc sử dụng 802.1X là gì?", options: ["Tăng tốc độ truyền dữ liệu", "Cải thiện bảo mật mạng bằng cách yêu cầu xác thực trước khi cấp quyền truy cập", "Đơn giản hóa việc cấu hình địa chỉ IP", "Giảm chi phí mua thiết bị mạng"], correctAnswer: 1, explanation: "802.1X tăng cường bảo mật bằng cách đảm bảo chỉ những người dùng và thiết bị hợp lệ, đã được xác thực mới có thể kết nối và truy cập vào tài nguyên mạng."}
        ];

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');

        const startBtn = document.getElementById('start-btn');
        const questionCounter = document.getElementById('question-counter');
        const scoreDisplay = document.getElementById('score-display');
        const questionText = document.getElementById('question-text');
        const answerOptionsContainer = document.getElementById('answer-options');
        const explanationText = document.getElementById('explanation');
        const nextBtn = document.getElementById('next-btn');
        const finalScoreText = document.getElementById('final-score-text');
        const resultMessage = document.getElementById('result-message');
        const restartBtn = document.getElementById('restart-btn');
        // CHANGED: Get both toggle buttons
        const toggleMusicStartBtn = document.getElementById('toggle-music-start-btn');
        const toggleMusicQuizBtn = document.getElementById('toggle-music-quiz-btn');

        const correctSound = document.getElementById('correct-sound');
        const incorrectSound = document.getElementById('incorrect-sound');
        const backgroundMusic = document.getElementById('background-music');

        // --- CHANGED: Set sound effect volume to maximum (1.0) ---
        // Note: This ensures maximum possible volume from the file, but CANNOT make a quiet file louder.
        // You need to edit the MP3 file itself for actual amplification.
        correctSound.volume = 1.0;
        incorrectSound.volume = 1.0;
        // You might want to adjust background music volume to be lower, e.g.:
        backgroundMusic.volume = 0.7; // 30% volume

        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let musicEnabled = false;

         function shuffleArray(array) {
            // Fisher-Yates Shuffle
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
         }

        function startGame() {
            startScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            quizScreen.classList.add('fade-in');

            shuffledQuestions = shuffleArray([...quizData]);
            currentQuestionIndex = 0;
            score = 0;
            scoreDisplay.textContent = `Điểm: ${score}`;
            nextBtn.style.display = 'none';
             explanationText.textContent = '';
             updateMusicButtonStates(); // Sync button state
            loadQuestion();

             if (musicEnabled) {
                 playBackgroundMusic(); // Use helper function
             }
        }

        function loadQuestion() {
             resetStyles();
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            questionCounter.textContent = `Câu ${currentQuestionIndex + 1} / ${shuffledQuestions.length}`;
            questionText.textContent = currentQuestion.question;
             answerOptionsContainer.innerHTML = '';
             explanationText.textContent = '';
             nextBtn.style.display = 'none';

            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-btn');
                 button.dataset.index = index;
                button.addEventListener('click', selectAnswer);
                answerOptionsContainer.appendChild(button);
            });
             questionText.classList.add('fade-in');
             answerOptionsContainer.classList.add('fade-in');
             setTimeout(() => {
                 questionText.classList.remove('fade-in');
                 answerOptionsContainer.classList.remove('fade-in');
             }, 500);
        }

         function resetStyles() {
             explanationText.textContent = '';
         }

        function selectAnswer(e) {
             const selectedButton = e.target;
             const selectedAnswerIndex = parseInt(selectedButton.dataset.index);
             const currentQuestion = shuffledQuestions[currentQuestionIndex];
             const correctAnswerIndex = currentQuestion.correctAnswer;

             Array.from(answerOptionsContainer.children).forEach(btn => {
                 btn.disabled = true;
             });

             if (selectedAnswerIndex === correctAnswerIndex) {
                 score++;
                 scoreDisplay.textContent = `Điểm: ${score}`;
                 selectedButton.classList.add('correct');
                 playSound(correctSound);
                 explanationText.textContent = "Chính xác! " + currentQuestion.explanation;
                 explanationText.style.color = '#155724';
             } else {
                 selectedButton.classList.add('incorrect');
                 playSound(incorrectSound);
                 const correctButton = answerOptionsContainer.querySelector(`[data-index="${correctAnswerIndex}"]`);
                 if(correctButton) {
                     correctButton.classList.add('show-correct');
                 }
                 explanationText.textContent = "Sai rồi! Đáp án đúng là: " + currentQuestion.options[correctAnswerIndex] + ". " + currentQuestion.explanation;
                 explanationText.style.color = '#721c24';
             }

             nextBtn.style.display = 'inline-block';
         }

        function showNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
            resultsScreen.classList.add('fade-in');
             backgroundMusic.pause(); // Stop music at results

            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            finalScoreText.textContent = `Điểm của bạn: ${score} / ${shuffledQuestions.length} (${percentage}%)`;

            let message = "";
            if (percentage === 100) message = "Xuất sắc! Bạn là một Cisco ISE Master thực thụ!";
            else if (percentage >= 80) message = "Rất tốt! Kiến thức của bạn về ISE rất vững chắc!";
            else if (percentage >= 50) message = "Khá lắm! Bạn đã nắm được những kiến thức cơ bản.";
            else message = "Cần cố gắng thêm! Hãy ôn lại tài liệu và thử lại nhé.";
            resultMessage.textContent = message;
        }

         function playSound(soundElement) {
             soundElement.currentTime = 0;
             soundElement.play().catch(e => console.log("Sound play failed:", e));
         }

         // --- CHANGED: Helper function for playing background music ---
         function playBackgroundMusic() {
             backgroundMusic.play().catch(e => {
                 console.log("Background music autoplay failed:", e);
                 // If autoplay fails, ensure the button state reflects music is off
                 musicEnabled = false;
                 updateMusicButtonStates();
             });
         }

         // --- CHANGED: Updated toggleMusic function ---
         function toggleMusic() {
             if (musicEnabled) {
                 backgroundMusic.pause();
                 musicEnabled = false;
             } else {
                 playBackgroundMusic(); // Attempt to play
                 musicEnabled = true; // Assume success initially, playBackgroundMusic corrects if needed
             }
             updateMusicButtonStates(); // Update button text/style
         }

         // --- CHANGED: New function to update button states ---
         function updateMusicButtonStates() {
             const buttonText = musicEnabled ? "Tắt Nhạc Nền" : "Bật Nhạc Nền";
             const buttonClassAction = musicEnabled ? 'add' : 'remove';

             toggleMusicStartBtn.textContent = buttonText;
             toggleMusicQuizBtn.textContent = buttonText;

             toggleMusicStartBtn.classList[buttonClassAction]('on');
             toggleMusicQuizBtn.classList[buttonClassAction]('on');
         }

        // Event Listeners
        startBtn.addEventListener('click', startGame);
        nextBtn.addEventListener('click', showNextQuestion);
        restartBtn.addEventListener('click', () => {
            resultsScreen.style.display = 'none';
             resultsScreen.classList.remove('fade-in');
             startScreen.style.display = 'block';
             startScreen.classList.add('fade-in');
              setTimeout(() => startScreen.classList.remove('fade-in'), 500);
             // Reset happens in startGame
        });
        // CHANGED: Add listeners to both buttons
        toggleMusicStartBtn.addEventListener('click', toggleMusic);
        toggleMusicQuizBtn.addEventListener('click', toggleMusic);

         window.addEventListener('load', () => {
             correctSound.load();
             incorrectSound.load();
             backgroundMusic.load();
         });

    </script>

</body>
</html>
